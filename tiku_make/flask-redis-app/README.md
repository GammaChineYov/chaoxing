# Flask Redis App

这是一个使用Flask和Redis构建的简单Web应用程序，提供用户身份验证和Redis操作的功能。

## 项目结构

```
flask-redis-app
├── src
│   ├── app.py          # 应用程序入口点
│   ├── auth.py         # 身份验证相关功能
│   ├── redis_client.py  # Redis数据库操作
│   └── templates
│       └── index.html  # HTML模板
├── requirements.txt     # 项目依赖
└── README.md            # 项目文档
```

## 安装

1. 克隆该项目：

   ```
   git clone <repository-url>
   cd flask-redis-app
   ```

2. 创建并激活虚拟环境（可选）：

   ```
   python -m venv venv
   source venv/bin/activate  # 在Linux或MacOS上
   venv\Scripts\activate     # 在Windows上
   ```

3. 安装依赖：

   ```
   pip install -r requirements.txt
   ```

## 配置

在运行应用程序之前，请确保您已安装并运行Redis服务器。您可以使用默认配置，或根据需要修改`src/redis_client.py`中的连接设置。

## 运行应用程序

在终端中运行以下命令启动Flask应用：

```
python src/app.py
```

应用程序将默认在`http://127.0.0.1:5000`上运行。

## 使用

访问`http://127.0.0.1:5000`以查看应用程序界面。您可以注册新用户并进行登录，以体验身份验证功能。

## 贡献

欢迎任何形式的贡献！请提交问题或拉取请求。

## 许可证

此项目采用MIT许可证。有关详细信息，请参阅LICENSE文件。

## 计划

### 侧边栏更新

- 更新`base.html`侧边栏中的“学习”选项对应到`study.html`
- 在“学习”选项下面添加“设置”、“学习进度”、“学习日志”子选项
- 在侧边栏左上角增加三条杠的图标，点击后可展开、隐藏侧边栏

### 学习页面实现

- 使用`socketio`和`jwt`实现`study.html`和`study.py`对应的学习页面
- 学习页面包含“设置”和“学习进度”两个标签页面板
- 手机端可左右滑动切换面板，或点击侧边栏对应按钮切换，或点击对应标签页按钮切换

### 设置标签面板

- “设置”标签面板有多个子面板
- 第一步设置账号密码，然后点击“登录”
- 参考`main.py`中的方法登录超星chaoxing
- 登录超星成功后显示绿色图标并提示登录成功，设置对应实例到用户session，使用`jwt`设置超星账号密码到用户cookies下次读取
- 登录失败显示红色图标并提示登录失败及其原因
- 下一个是课程设置子面板，在登录完成后自动更新并下滑到该面板
- 该面板用复选框列表列出用户的所有课程名称（参考`main.py`中的课程加载方式）及其历史完成状态（绿色已完成，黄色进行中，默认没有记录）
- 用户可以选择需要学习的课程，然后点击“开始学习”（已经开始则显示“重新开始”），然后跳转到“学习进度”标签面板

### 学习进度标签面板

- 学习进度子面板使用动态树状图显示当前学习的课程、章节、任务点，包括名称，当前用时，课程的章节进度（章节的任务点进度）xx/xx
- 使用`socketio`实时更新进度
- 底部有总进度子面板，显示本次学习的总学习时间，单任务点平均完成时间，单章节平均完成时间，并包含一个“停止”按钮

### 学习日志标签面板

- 当用户在“学习日志”标签面板时实时增量推送学习线程的日志到该面板（首次进入面板时先推送历史日志）
- 该面板同时包含“暂停/继续”、“停止”按钮

### 学习相关对象实体和用户进度实体模型

- 在`study_models.py`中定义学习相关的对象实体和用户进度实体模型
- 确保用户刷新页面或者重新登录后可以得到最新的学习状态，并且用户的刷新、退出、重新登录不影响学习线程的执行

根据计划实现部分和修改意见，继续完善项目。并输出完善后的计划实现部分。
## 管理员功能
### 爬虫管理
- base.html中的管理员选项下面添加“爬虫管理”子选项，对应scraper_manage.html，并在scraper_manage.py中实现对应视图
- 爬虫管理页面分“爬虫管理”和“测试”两个标签页面板，“爬虫管理”面板包含“爬虫进程列表“和”操作”两个子面板，目前可管理的爬虫脚本为question_scraper.py
- 爬虫进程列表显示爬虫名称、状态、运行时间、操作按钮（默认隐藏，选中后显示，点击后手机端后从底部向上弹出操作子面板，电脑端出现菜单）
- 操作子面板包含“启动”、“停止”、“重启”、“查看日志”按钮，点击后对选中的爬虫进程执行对应操作
- 爬虫进程列表使用动态表格显示，使用socketio实时更新爬虫进程状态
- 爬虫进程列表底部有“添加爬虫”按钮，点击后弹出添加爬虫对话框，输入爬虫名称、爬虫类型、爬虫参数，点击“确定”后提交到后端，后端启动爬虫进程并返回结果，前端显示结果
- 爬虫进程列表底部有“刷新”按钮，点击后强制刷新爬虫进程列表
- 爬虫进程列表底部有“清除”按钮，点击后出现"取消"和“确认”按钮覆盖底部，并在爬虫进程列表显示复选框和在顶部显示全选框，点确认后清除选中的爬虫进程
- 启动爬虫进程后日志输出到logs文件夹下，日志文件名为爬虫名称+时间戳.log
- “测试”面板包含redis调度器队列名称下拉框和"发送任务“、“删除测试结果”按钮，参考request_from_cache.py中的方法，点击后发送任务到分布式爬虫调度器，使用socketio实时更新任务状态,任务状态有“等待”、“进行中”、“完成”、“失败”四种，任务完成后显示结果,其中“等待”为任务仍在队列中等待执行，“进行中”为任务发送到爬虫进程节点正在执行，“完成”为节点返回了非空结果，“失败”为节点返回了空结果或者发生了异常；点击“删除测试结果”按钮后从调度器中删除结果集中与输入框对应的任务

#### 修改意见
##### craper_manage.html
##### scraper_manage.py
##### scraper_manage.py 和 scraper_manage.html
